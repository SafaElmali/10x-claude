# Ralph Linear Workflow Diagram

## High-Level Overview

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           RALPH LINEAR WORKFLOW                              │
│                                                                             │
│  /ralph-linear WEB-1234                                                     │
│         │                                                                   │
│         ▼                                                                   │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐  │
│  │   Phase 0   │───▶│   Phase 1   │───▶│  Phase 1.5  │───▶│   Phase 2   │  │
│  │   Setup     │    │    PRD      │    │  Clarify &  │    │   Agent     │  │
│  │             │    │  Creation   │    │   Approve   │    │  Selection  │  │
│  └─────────────┘    └─────────────┘    └──────┬──────┘    └──────┬──────┘  │
│                                               │                  │         │
│                                       ASK QUESTIONS              ▼         │
│                                       + USER GATE                          │
│                                          (y/n/adjust)     ┌─────────────┐  │
│                                                           │   Phase 3   │  │
│                                                           │   Implement │  │
│                                                           │    Loop     │  │
│                                                           └──────┬──────┘  │
│                                                                   │         │
│                                                                   ▼         │
│                                              ┌─────────────┐    ┌─────────┐ │
│                                              │   Phase 5   │◀───│ Phase 4 │ │
│                                              │  Create PR  │    │  Test   │ │
│                                              └──────┬──────┘    └─────────┘ │
│                                                     │                       │
│                                                     ▼                       │
│                                          <promise>COMPLETE</promise>        │
└─────────────────────────────────────────────────────────────────────────────┘
```

## Detailed Phase Breakdown

### Phase 0: Setup & Context Gathering

```
┌────────────────────────────────────────────────────────┐
│                    PHASE 0: SETUP                       │
├────────────────────────────────────────────────────────┤
│                                                        │
│  ┌──────────────┐                                      │
│  │ Fetch Ticket │ ◀─── Linear API (get_issue)          │
│  └──────┬───────┘                                      │
│         │                                              │
│         ▼                                              │
│  ┌──────────────┐                                      │
│  │ Analyze Scope│                                      │
│  └──────┬───────┘                                      │
│         │                                              │
│         ├─── Small (bug fix)      → 5-10 iterations    │
│         ├─── Medium (component)   → 15-25 iterations   │
│         └─── Large (feature)      → 30-50 iterations   │
│                                                        │
│         ▼                                              │
│  ┌──────────────┐                                      │
│  │ Create       │ ◀─── progress.txt                    │
│  │ Progress File│                                      │
│  └──────┬───────┘                                      │
│         │                                              │
│         ▼                                              │
│  ┌──────────────┐     ┌─────────┐                      │
│  │ Requirements │────▶│ ASK USER│ (if unclear)         │
│  │ Clear?       │ NO  └─────────┘                      │
│  └──────┬───────┘                                      │
│      YES│                                              │
│         ▼                                              │
│     [Phase 1]                                          │
└────────────────────────────────────────────────────────┘
```

### Phase 1: PRD Creation

```
┌────────────────────────────────────────────────────────┐
│              PHASE 1: PRD CREATION                      │
├────────────────────────────────────────────────────────┤
│                                                        │
│  ┌─────────────────────────────────────┐               │
│  │              PRD                     │               │
│  ├─────────────────────────────────────┤               │
│  │ • Problem Statement (one sentence)  │               │
│  │ • Solution (one sentence)           │               │
│  │ • Acceptance Criteria    ◀── Key!   │               │
│  └──────────┬──────────────────────────┘               │
│             │                                          │
│             ▼                                          │
│  ┌─────────────────────┐                               │
│  │ Update progress.txt │                               │
│  └──────────┬──────────┘                               │
│             │                                          │
│             ▼                                          │
│         [Phase 1.5]                                    │
└────────────────────────────────────────────────────────┘
```

### Phase 1.5: Clarification & Plan Approval

```
┌────────────────────────────────────────────────────────┐
│        PHASE 1.5: CLARIFICATION & PLAN APPROVAL         │
├────────────────────────────────────────────────────────┤
│                                                        │
│  ┌──────────────────────────────────────────────────┐  │
│  │         STEP 1: CLARIFICATION LOOP                │  │
│  └──────────────────────────────────────────────────┘  │
│                                                        │
│                 ┌──────────────────┐                   │
│                 │ Review Ticket &  │                   │
│                 │ Identify Unclear │                   │
│                 │ Requirements     │                   │
│                 └────────┬─────────┘                   │
│                          │                             │
│                          ▼                             │
│                 ┌──────────────────┐                   │
│                 │ Any Ambiguities? │                   │
│                 └────────┬─────────┘                   │
│                          │                             │
│            ┌─────────────┴─────────────┐               │
│            │ YES                    NO │               │
│            ▼                           │               │
│   ┌─────────────────┐                  │               │
│   │ Ask Clarifying  │                  │               │
│   │ Questions       │                  │               │
│   └────────┬────────┘                  │               │
│            │                           │               │
│            ▼                           │               │
│   ┌─────────────────┐                  │               │
│   │ Wait for User   │                  │               │
│   │ Answers         │                  │               │
│   └────────┬────────┘                  │               │
│            │                           │               │
│            └──────▶ [Loop until clear] │               │
│                                        │               │
│            ┌───────────────────────────┘               │
│            │                                           │
│            ▼                                           │
│  ┌──────────────────────────────────────────────────┐  │
│  │         STEP 2: PLAN APPROVAL                     │  │
│  └──────────────────────────────────────────────────┘  │
│                                                        │
│  ┌──────────────────────────────────────────────────┐  │
│  │              PLAN SUMMARY                         │  │
│  ├──────────────────────────────────────────────────┤  │
│  │ Problem: {one sentence}                          │  │
│  │ Solution: {one sentence}                         │  │
│  │                                                  │  │
│  │ Tasks:                                           │  │
│  │ 1. Task description                              │  │
│  │ 2. Task description                              │  │
│  │ 3. Visual validation                             │  │
│  │ 4. Create PR                                     │  │
│  │                                                  │  │
│  │ Agent: fullstack-developer                       │  │
│  │ Files: src/components/X.tsx, src/api/Y.ts        │  │
│  └──────────────────────────────────────────────────┘  │
│                                                        │
│                        │                               │
│                        ▼                               │
│               ┌─────────────────┐                      │
│               │  USER DECISION  │ ◀─── BLOCKING GATE   │
│               └────────┬────────┘                      │
│                        │                               │
│        ┌───────────────┼───────────────┐               │
│        │               │               │               │
│        ▼               ▼               ▼               │
│   ┌─────────┐    ┌───────────┐   ┌───────────┐         │
│   │   YES   │    │    NO     │   │  ADJUST   │         │
│   │ Approve │    │  Reject   │   │  Modify   │         │
│   └────┬────┘    └─────┬─────┘   └─────┬─────┘         │
│        │               │               │               │
│        │               ▼               ▼               │
│        │        ┌─────────────────────────┐            │
│        │        │ Ask what's wrong /      │            │
│        │        │ Incorporate feedback    │            │
│        │        └───────────┬─────────────┘            │
│        │                    │                          │
│        │                    ▼                          │
│        │            ┌──────────────┐                   │
│        │            │ Revise Plan  │                   │
│        │            └──────┬───────┘                   │
│        │                   │                           │
│        │                   └──────▶ [Back to Gate]     │
│        │                                               │
│        ▼                                               │
│   [Phase 2: Agent Selection]                           │
│                                                        │
└────────────────────────────────────────────────────────┘
```

### Phase 2: Agent Selection

```
┌──────────────────────────────────────────────────────────────────────────┐
│                       PHASE 2: AGENT SELECTION                            │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│                       ┌─────────────────────┐                            │
│                       │ Does task require   │                            │
│                       │   UI changes?       │                            │
│                       └──────────┬──────────┘                            │
│                                  │                                       │
│                 ┌────────────────┴────────────────┐                      │
│                 │ NO                          YES │                      │
│                 ▼                                 ▼                      │
│     ┌─────────────────────┐           ┌─────────────────────┐            │
│     │ Is it Ruby/Rails?   │           │ Does task require   │            │
│     └──────────┬──────────┘           │ API/DB changes?     │            │
│                │                      └──────────┬──────────┘            │
│       ┌────────┴────────┐                        │                       │
│       │ YES          NO │            ┌───────────┴───────────┐           │
│       ▼                 ▼            │ NO                YES │           │
│  ┌────────────┐  ┌────────────┐      ▼                      ▼           │
│  │  senior-   │  │  backend-  │ ┌──────────────┐    ┌──────────────────┐ │
│  │  rails-    │  │  developer │ │  frontend-   │    │   fullstack-     │ │
│  │  backend-  │  │            │ │  developer   │    │   developer      │ │
│  │  dev       │  │ • Node/TS  │ │              │    │                  │ │
│  │            │  │ • API      │ │ • UI only    │    │ • API + UI       │ │
│  │ • Rails    │  │ • Database │ │ • React      │    │ • Data flow      │ │
│  │ • Ruby     │  │ • Auth     │ │ • Styling    │    │ • Type sync      │ │
│  │ • Sidekiq  │  │ • Jobs     │ │ • State      │    │ • E2E features   │ │
│  │ • ActiveRec│  └────────────┘ └──────────────┘    └──────────────────┘ │
│  └────────────┘                                                          │
│                                                                          │
│  Log selection reasoning → progress.txt                                  │
└──────────────────────────────────────────────────────────────────────────┘
```

### Phase 3: Implementation Loop

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    PHASE 3: IMPLEMENTATION LOOP                          │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                    ITERATION {N}/{max}                           │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                         │
│         ┌──────────────────┐                                            │
│         │ Show Task List   │                                            │
│         │ as Checkboxes    │                                            │
│         └────────┬─────────┘                                            │
│                  │                                                      │
│                  ▼                                                      │
│         ┌──────────────────┐                                            │
│         │ Work on Next     │                                            │
│         │ Unchecked Task   │                                            │
│         └────────┬─────────┘                                            │
│                  │                                                      │
│                  ▼                                                      │
│  ┌───────────────────────────────────────────────────────────────┐      │
│  │                    FEEDBACK LOOPS                              │      │
│  ├───────────────────────────────────────────────────────────────┤      │
│  │                                                               │      │
│  │   Frontend Changes?                                           │      │
│  │         │                                                     │      │
│  │         ▼                                                     │      │
│  │   ┌─────────────┐     ┌─────────────┐                         │      │
│  │   │  pnpm lint  │────▶│   FAILED?   │───▶ Fix & Retry         │      │
│  │   └─────────────┘     └──────┬──────┘                         │      │
│  │                           PASS│                               │      │
│  │                              ▼                                │      │
│  │   ┌─────────────┐     ┌─────────────┐                         │      │
│  │   │  pnpm test  │────▶│   FAILED?   │───▶ Fix & Retry         │      │
│  │   └─────────────┘     └──────┬──────┘                         │      │
│  │                           PASS│                               │      │
│  └───────────────────────────────┼───────────────────────────────┘      │
│                                  │                                      │
│                                  ▼                                      │
│                  ┌──────────────────────────┐                           │
│                  │ git commit               │                           │
│                  │ (after EACH task)        │                           │
│                  └────────────┬─────────────┘                           │
│                               │                                         │
│                               ▼                                         │
│                  ┌──────────────────────────┐                           │
│                  │ Update progress.txt      │                           │
│                  └────────────┬─────────────┘                           │
│                               │                                         │
│                               ▼                                         │
│                  ┌──────────────────────────┐                           │
│                  │ All Acceptance Criteria  │                           │
│                  │ Met?                     │                           │
│                  └────────────┬─────────────┘                           │
│                               │                                         │
│              ┌────────────────┴────────────────┐                        │
│              │ NO                          YES │                        │
│              ▼                                 ▼                        │
│     [Next Iteration]                      [Phase 4]                     │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │  BLOCKED?  ───▶  ASK USER  ───▶  Document in progress.txt       │    │
│  └─────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────┘
```

### Phase 4 & 5: Validation & PR

```
┌────────────────────────────────────────────────────────────────────┐
│                 PHASE 4: TESTING & VALIDATION                       │
├────────────────────────────────────────────────────────────────────┤
│                                                                    │
│  ┌─────────────┐   ┌─────────────┐   ┌─────────────┐               │
│  │ Full Test   │──▶│ Acceptance  │──▶│   Visual    │               │
│  │ Suite       │   │ Criteria    │   │ Validation  │               │
│  └──────┬──────┘   └──────┬──────┘   └──────┬──────┘               │
│         │                 │                 │                      │
│         └────────────┬────┴─────────────────┘                      │
│                      │                                             │
│                      ▼                                             │
│              ┌──────────────┐                                      │
│              │  ALL PASS?   │                                      │
│              └──────┬───────┘                                      │
│                     │                                              │
│        ┌────────────┴────────────┐                                 │
│        │ NO                  YES │                                 │
│        ▼                        ▼                                  │
│  ┌───────────┐           ┌─────────────┐                           │
│  │ Fix Issues│           │  Phase 5    │                           │
│  │ (loop)    │           │             │                           │
│  └───────────┘           └──────┬──────┘                           │
│                                 │                                  │
└─────────────────────────────────┼──────────────────────────────────┘
                                  │
                                  ▼
┌────────────────────────────────────────────────────────────────────┐
│                    PHASE 5: PR CREATION                             │
├────────────────────────────────────────────────────────────────────┤
│                                                                    │
│  ┌─────────────────┐                                               │
│  │ Final Commit    │ (if uncommitted changes)                      │
│  └────────┬────────┘                                               │
│           │                                                        │
│           ▼                                                        │
│  ┌─────────────────┐                                               │
│  │ git push -u     │                                               │
│  │ origin <branch> │                                               │
│  └────────┬────────┘                                               │
│           │                                                        │
│           ▼                                                        │
│  ┌─────────────────┐                                               │
│  │ gh pr create    │                                               │
│  └────────┬────────┘                                               │
│           │                                                        │
│           ▼                                                        │
│  ┌─────────────────────────────────────────┐                       │
│  │                                         │                       │
│  │       <promise>COMPLETE</promise>       │                       │
│  │                                         │                       │
│  └─────────────────────────────────────────┘                       │
│                                                                    │
│  Cleanup Reminders:                                                │
│  • Delete progress.txt                                             │
│  • Run work-tickets --cleanup                                      │
└────────────────────────────────────────────────────────────────────┘
```

## work-tickets Integration

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        work-tickets --ralph                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   $ work-tickets --ralph WEB-5388 WEB-5504                              │
│                      │                                                  │
│                      ▼                                                  │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │                    For Each Ticket                               │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                      │                                                  │
│         ┌────────────┴────────────┐                                     │
│         ▼                         ▼                                     │
│   ┌───────────┐            ┌───────────┐                                │
│   │ WEB-5388  │            │ WEB-5504  │                                │
│   └─────┬─────┘            └─────┬─────┘                                │
│         │                        │                                      │
│         ▼                        ▼                                      │
│   ┌───────────────────┐    ┌───────────────────┐                        │
│   │ Create Worktree   │    │ Create Worktree   │                        │
│   │ ~/Desktop/swarm-  │    │ ~/Desktop/swarm-  │                        │
│   │   WEB-5388        │    │   WEB-5504        │                        │
│   └─────────┬─────────┘    └─────────┬─────────┘                        │
│             │                        │                                  │
│             ▼                        ▼                                  │
│   ┌───────────────────┐    ┌───────────────────┐                        │
│   │ Split Terminal    │    │ Split Terminal    │                        │
│   │ (Cmd+D)           │    │ (Cmd+D)           │                        │
│   └─────────┬─────────┘    └─────────┬─────────┘                        │
│             │                        │                                  │
│             ▼                        ▼                                  │
│   ┌───────────────────┐    ┌───────────────────┐                        │
│   │ cc '/ralph-linear │    │ cc '/ralph-linear │                        │
│   │   WEB-5388'       │    │   WEB-5504'       │                        │
│   └───────────────────┘    └───────────────────┘                        │
│                                                                         │
│   Terminal Layout:                                                      │
│   ┌─────────────────────┬─────────────────────┐                         │
│   │                     │                     │                         │
│   │     WEB-5388        │     WEB-5504        │                         │
│   │                     │                     │                         │
│   │  Ralph Linear       │  Ralph Linear       │                         │
│   │  Running...         │  Running...         │                         │
│   │                     │                     │                         │
│   └─────────────────────┴─────────────────────┘                         │
│                                                                         │
│   Supported Terminals: Warp, iTerm2, Terminal.app                       │
└─────────────────────────────────────────────────────────────────────────┘
```

## Progress File Lifecycle

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      progress.txt Lifecycle                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   Phase 0                     Phase 3                    Cleanup        │
│      │                           │                          │           │
│      ▼                           ▼                          ▼           │
│  ┌────────┐               ┌────────────┐              ┌────────────┐    │
│  │ CREATE │──────────────▶│   UPDATE   │─────────────▶│   DELETE   │    │
│  └────────┘               │ (each iter)│              └────────────┘    │
│                           └────────────┘                                │
│                                                                         │
│  Contents:                                                              │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │ ## Ralph Linear Progress                                        │    │
│  │                                                                 │    │
│  │ Ticket: WEB-5388                                                │    │
│  │ Agent: fullstack-developer                                      │    │
│  │ Started: 2026-01-22 10:30                                       │    │
│  │                                                                 │    │
│  │ ## Iteration 3                                                  │    │
│  │                                                                 │    │
│  │ ### Completed                                                   │    │
│  │ - Created API endpoint - src/api/users.ts                       │    │
│  │ - Added UserProfile component - src/components/UserProfile.tsx  │    │
│  │ - Decision: Used React Query for caching                        │    │
│  │                                                                 │    │
│  │ ### Next                                                        │    │
│  │ - Add tests for API endpoint                                    │    │
│  │                                                                 │    │
│  │ ### Blockers                                                    │    │
│  │ - None                                                          │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                         │
│  Purpose: Short-circuit exploration, give Ralph context quickly         │
└─────────────────────────────────────────────────────────────────────────┘
```

## Commit Strategy

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        COMMIT AFTER EACH TASK                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  Task 1          Task 2          Task 3          Task 4                 │
│     │               │               │               │                   │
│     ▼               ▼               ▼               ▼                   │
│  ┌──────┐        ┌──────┐        ┌──────┐        ┌──────┐               │
│  │Commit│        │Commit│        │Commit│        │Commit│               │
│  │  1   │───────▶│  2   │───────▶│  3   │───────▶│  4   │               │
│  └──────┘        └──────┘        └──────┘        └──────┘               │
│                                                                         │
│  Benefits:                                                              │
│  • Clean git log showing what changed                                   │
│  • Ability to git diff against previous work                            │
│  • Rollback point if something breaks                                   │
│  • Future iterations see context in history                             │
│                                                                         │
│  Format:                                                                │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │ feat: add user profile API endpoint                             │    │
│  │                                                                 │    │
│  │ - Created GET /api/users/:id endpoint                           │    │
│  │ - Added validation with Zod                                     │    │
│  │                                                                 │    │
│  │ Ticket: WEB-5388                                                │    │
│  └─────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────┘
```
